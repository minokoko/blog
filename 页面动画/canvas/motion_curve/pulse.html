<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Pulse Demo</title>
	<style>
		#canvas{
			position: absolute;
			left: 50%;
			margin-left: -200px;
			border: 1px solid #0ff;
		}
	</style>
</head>
<body>
	<canvas id="canvas" width="400" height="400" style="
    transform: rotate(180deg);"></canvas>
	<script>
		var $canvas = document.getElementById('canvas');
		var ctx = $canvas.getContext('2d');

		var $cacheCanvas = document.createElement('canvas');
		$cacheCanvas.width = 20;
		$cacheCanvas.height = 20;
		var cacheCtx = $cacheCanvas.getContext('2d');
		var pulses=[{
			x: 110,
			y: 200,
			w: 10,
			h: 35,
			modify: 10
		},{
			x: 122,
			y: 200,
			w: 10,
			h: 45,
			modify: 15
		},{
			x: 134,
			y: 200,
			w: 10,
			h: 15,
			modify: 10
		},{
			x: 146,
			y: 200,
			w: 10,
			h: 25,
			modify: 10
		},{
			x: 158,
			y: 200,
			w: 10,
			h: 55,
			modify: 15
		},{
			x: 170,
			y: 200,
			w: 10,
			h: 25,
			modify: 10
		},{
			x: 182,
			y: 200,
			w: 10,
			h: 45,
			modify: 20
		},{
			x: 194,
			y: 200,
			w: 10,
			h: 10,
			modify: 10
		},{
			x: 206,
			y: 200,
			w: 10,
			h: 43,
			modify: 15
		},{
			x: 218,
			y: 200,
			w: 10,
			h: 15,
			modify: 10
		},{
			x: 230,
			y: 200,
			w: 10,
			h: 40,
			modify: 10
		},{
			x: 242,
			y: 200,
			w: 10,
			h: 35,
			modify: 10
		}];
		function drawRect(p, m){
			ctx.beginPath();
			ctx.fillStyle=p.color||"#f0f";
			ctx.rect(p.x, p.y, p.w, p.h+m);
			ctx.closePath();
			ctx.fill();
		}

		var deg = 0;
		function move(){
			ctx.clearRect(0, 0, 400, 400);
			var tmp;
			var sin;
			for(var i=0;i<pulses.length;i++){
				sin = Math.sin(deg*Math.sin((i+1)/5))+1;//0~1
				tmp = pulses[i];
				tmp.color = 'rgb(' + Math.floor(255- 22.5*i) + ', 0,' +
                       Math.floor(255-12.5*i) + ')';
				drawRect(tmp, sin*tmp.modify);
			}

			deg += 0.3;
			requestAnimationFrame(move);
		}
		requestAnimationFrame(move);
	</script>
</body>
</html>