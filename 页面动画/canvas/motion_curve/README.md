> 学用canvas系列 

麻蛋，我为什么要做这篇文章，要死。。。。。。  

随着HTML5定稿，CSS3动画、canvas动画、svg动画，各种形式的动画开始应用到各式各样的页面中。年关将近，对这一年的动画做一个总结。  
## 动画效果-运动轨迹，运动曲线  
### 为什么需要动画效果？  
无论是CSS3动画、javascript动画、canvas动画、svg动画，它们服务的目标是一致的，均是为了增强页面的表现力。  
简单来说动画效果可以从以下两个方面提高页面效果:  
1. 视觉效果
    这点我们可以从现在风靡的H5海报去理解。  
    举个例子：在冬至时要吃饺子(习俗，习俗，我也不知道为啥o(╯□╰)o)，刚好要做一个普及这一习俗的H5海报页，我们可以通过飘飞的雪花、热气腾腾饺子等去提高页面的表现力，营造出冬至的氛围。  
    ![冬至飘雪](http://ozp3e2myx.bkt.clouddn.com/winter.gif?111)  
    这里就有动画效果对视觉效果的提升：**营造氛围，更契合主题**。
2. 视觉引导
    重点突出‘引导’，可以间接的提示页面各个部件的位置，作用。  
    举个例子：购物网站在将产品加入购物车时，产品飞入了边缘的购物车图标上。如下：  
    ![视觉引导](http://ozp3e2myx.bkt.clouddn.com/lead.gif)  
    这里就有动画效果的引导作用：**1. 告诉用户购物车的位置 2. 告知用户加入购物车成功**  

无论哪种类型的动画效果，“自然”的动画才能有用于页面。

### 自然的动画效果  
自然的动画效果应该符合我们现实生活中物理运动轨迹，我们应该避免做出形而上学的动画效果。例如，小球弹跳的动画，路径上是随着弹跳高度越来越小直至不动，速度上会越来越慢直至为零。而这些改变的背后，是可以用牛顿运动方程式表达的。也就说要想做出自然的动画，我们需要掌握各种函数曲线(书到用时方恨少/(ㄒoㄒ)/\~\~)......。  

再看看我们做过的、介绍这些动画效果，其背后最大的功臣就是以下两位：  
1. 运动轨迹的变化  
2. 运动曲线与缓动函数  

而它们哥俩包含了各种各样的函数表达式。

### 运动轨迹  
妈呀，好多运动轨迹的函数表达式呀：最简单的直线，稍复杂的弧线，在复杂写抛物线，更复杂三角函数线。。。。。。  

运动轨迹从简单直线运动到复杂的无规则运动都是有自己的函数表达式。这里介绍几种动画效果中常用的运动轨迹表达式。  

注：以下demo均采用canvas实现
1. 圆形轨迹
    > 相关表达式
    > (x-a)^2+(y-b)^2=r^2;
    > a b为圆心，x y为坐标
    > 通过弧度求x y坐标
    > x = r \* cos(wt)
    > y = r \* sin(wt)  

    ![三角函数](http://ozp3e2myx.bkt.clouddn.com/sanjiao.png)

    小球运动-圆形轨迹demo  
    ![小球运动-圆形](http://ozp3e2myx.bkt.clouddn.com/arcdemo.gif)  
    画圆关键：
    ```javascript
    //R：常量圆形轨迹的半径；
    //a , b常量 圆形轨迹的圆心
    var x = R * Math.cos(deg*Math.PI/180) + a;
    var y = R * Math.sin(deg*Math.PI/180) + b;

    requestAnimationFrame(move);
    ```

    这里需要注意：**在关于角度的计算表达式中一般使用弧度制**， 关于弧度与角度的转换：  
    > 1度 = Math.PI/180
    > 1deg = 180/Math.PI


2. 椭圆轨迹  
    椭圆其实我是很抗拒的，连圆相关的计算表达式都还给老师，别说它了。咳咳，仍然还是需要了解椭圆的。  
    照例表达式如下：  
    > |PF1|+|PF2|=2a (2a>|F1F2|)

    (๑•ᴗ•๑) 这是个啥。。。。。。
    > 椭圆（Ellipse）是平面内到定点F1、F2的距离之和等于常数（大于|F1F2|）的动点P的轨迹，F1、F2称为椭圆的两个焦点。其数学表达式为：|PF1|+|PF2|=2a（2a>|F1F2|）。  
    > 方程式：  
    > 焦点在X轴, x^2/a^2 + y^2/b^2 = 1
    > 焦点在Y轴，y^2/a^2 + x^2/b^2 = 1

    如果想更深入的拾取高中知识，请自行解决。   
    转化成我们可用的计算表达式:  
    > x = a*cos(wt) ， y = b*sin(wt)

    在canvas中没有提供画椭圆的API，这里通过椭圆方程式利用lineTo方法画椭圆(其他绘制椭圆的方法，可自行思考或搜索)。  
    关键代码：  
    ```javascript
    function drawEllipse(context, x, y, a, b){
         //max是等于1除以长轴值a和b中的较大者
        //i每次循环增加1/max，表示度数的增加
        //这样可以使得每次循环所绘制的路径（弧线）接近1像素
        var step = (a > b) ? 1 / a : 1 / b;
        context.beginPath();
        context.strokeStyle="#ff0";
        context.moveTo(x + a, y); //从椭圆的左端点开始绘制
        for (var i = 0; i < 2 * Math.PI; i += step)
        {
            //参数方程为x = a * cos(i), y = b * sin(i)，
            //参数为i，表示度数（弧度）
            context.lineTo(x + a * Math.cos(i), y + b * Math.sin(i));
        }
        context.closePath();
        context.stroke();
    }
    ```
    小球运动-椭圆轨迹  
    ![小球运动-椭圆轨迹](http://ozp3e2myx.bkt.clouddn.com/ellipse.gif)  
    椭圆轨迹关键:  
    ```javascript
    //ar, br：常量椭圆轨迹的焦点距离；
    //a , b常量 椭圆轨迹的中心
    var x = ar * Math.cos(offset*Math.PI/180) + a;
    var y = br * Math.sin(offset*Math.PI/180) + b;

    requestAnimationFrame(move);
    ```
3. 抛物线轨迹
    关于抛物线，截取圆或者椭圆的某一部分可以当做抛物线，或者贝塞尔曲线也可以模拟出抛物线。但是，抛物有着自己的函数表达式。  
    照例表达式如下:  
    > y=ax^2+bx+c
    为了便于计算，我们都假设抛物线经过原点(0, 0)，那么可以得到**y=ax^2+bx**。a类似常量弧度由我们给定值，剩下的只需要求解b的值。  
    > b = (y-ax^2)/x

    小球运动-抛物线  
    ![抛物线](http://ozp3e2myx.bkt.clouddn.com/para.gif)
4. 摆动轨迹
5. 三角函数类
### 运动曲线与缓动函数